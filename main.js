(()=>{"use strict";var e={d:(t,r)=>{for(var o in r)e.o(r,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:r[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{EH:()=>O});var t=document.querySelector("#profile-overlay"),r=t.querySelector("#form__name"),o=t.querySelector("#form__nickname"),n=document.querySelector(".profile__name"),c=document.querySelector(".profile__nickname"),a=document.querySelector(".profile__avatar"),s=document.querySelector("#add-overlay"),i=s.querySelector("#add__image-name"),l=s.querySelector("#add__image-url"),u=document.querySelector(".cards"),d=document.querySelector(".profile__edit-button"),f=document.querySelector(".profile__add-button"),m=(t.querySelector(".popup-wrapper__close"),s.querySelector(".popup-wrapper__close"),document.querySelector("#image-overlay")),_=m.querySelector(".image-modal__item"),v=m.querySelector(".image-modal__title"),p=(m.querySelector(".popup-wrapper__close"),document.forms.editForm),h=p.querySelector(".form__submit"),y=document.forms.addForm,S=y.querySelector(".form__submit"),b=document.forms.avatarForm,q=b.querySelector(".form__submit"),L=(p.querySelector(".form__element"),y.querySelector(".form__element"),b.querySelector(".form__element")),g=document.querySelector("#avatar-overlay");function E(e){O.forEach((function(t){"Escape"===e.key&&C(t)}))}function k(e){e.classList.add("popup_opened"),document.addEventListener("keydown",E)}function C(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",E)}function x(e,t){t.textContent=e?"Сохранить...":"Сохранить"}function A(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}g.querySelector(".popup-wrapper__close");var w={baseUrl:"https://nomoreparties.co/v1/cohort-55",headers:{authorization:"4a077796-6e98-44e5-9c13-60ffdba9f31a","Content-Type":"application/json"}};function U(e,t){var r=function(e,t){var r=e,o=t,n=r.owner._id,c=r.name,a=r.link,s=r._id,i=r.likes,l=i.length,u=document.querySelector(".card-template").content.querySelector(".card").cloneNode(!0),d=u.querySelector(".card__mask"),f=u.querySelector(".card__like"),p=u.querySelector(".card__trash");return d.setAttribute("src",a),d.setAttribute("alt",c),u.querySelector(".card__title").textContent=c,u.querySelector(".card__like-count").textContent=l,i.forEach((function(e){var t=e._id;o===t?f.classList.add("card__like_active"):f.classList.remove("card__like_active")})),f.addEventListener("click",(function(e){!function(e,t,r){var o,n=r.querySelector(".card__like-count");e.target.classList.contains("card__like")&&e.target.classList.contains("card__like_active")?(o=t,fetch("".concat(w.baseUrl,"/cards/likes/").concat(o),{method:"DELETE",headers:w.headers}).then(A)).then((function(t){var r=t.likes;e.target.classList.remove("card__like_active"),n.textContent=r.length})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(w.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:w.headers}).then(A)}(t).then((function(t){var r=t.likes;e.target.classList.add("card__like_active"),n.textContent=r.length})).catch((function(e){console.log(e)}))}(e,s,u)})),o===n?p.addEventListener("click",(function(e){!function(e,t){var r=e.target.closest(".card");console.log(t),e.target.classList.contains("card__trash")&&function(e){return fetch("".concat(w.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:w.headers}).then(A)}(t).then((function(e){console.log(e),r.remove()})).catch((function(e){console.log(e)}))}(e,s)})):p.remove(),d.addEventListener("click",(function(e){var t,r;t=e.target,r=u.querySelector(".card__title"),_.setAttribute("src","".concat(t.getAttribute("src"))),_.setAttribute("alt","".concat(t.getAttribute("alt"))),v.textContent=r.textContent,k(m)})),u}(e,t);u.prepend(r)}function P(e,t,r){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(r.disabledButtonClass),t.removeAttribute("disabled")):(t.classList.add(r.disabledButtonClass),t.setAttribute("disabled",!0))}var T,O=document.querySelectorAll(".popup"),D=fetch("".concat(w.baseUrl,"/users/me"),{headers:w.headers}).then(A),j=fetch("".concat(w.baseUrl,"/cards"),{headers:w.headers}).then(A);Promise.all([D,j]).then((function(e){var t=e[0],r=t.avatar,o=t.name,s=t.about,i=t._id;a.setAttribute("src",r),n.textContent=o,c.textContent=s,e[1].forEach((function(e){U(e,i)}))})).catch((function(e){console.log(e)})),d.addEventListener("click",(function(){k(t),r.value=n.textContent,o.value=c.textContent})),O.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_opened")&&C(e),t.target.classList.contains("popup-wrapper__close")&&C(e)}))})),f.addEventListener("click",(function(){k(s)})),a.addEventListener("click",(function(){k(g)})),p.addEventListener("submit",(function(e){var a,s;e.preventDefault(),x(!0,h),(a=r,s=o,fetch("".concat(w.baseUrl,"/users/me"),{method:"PATCH",headers:w.headers,body:JSON.stringify({name:"".concat(a.value),about:"".concat(s.value)})}).then(A)).then((function(e){n.textContent=e.name,c.textContent=e.about,C(t)})).catch((function(e){console.log("Ошибка: ".concat(e.status))})).finally((function(){x(!1,h)}))})),y.addEventListener("submit",(function(e){var t,r;e.preventDefault(),x(!0,S),(t=i.value,r=l.value,fetch("".concat(w.baseUrl,"/cards"),{method:"POST",headers:w.headers,body:JSON.stringify({name:"".concat(t),link:"".concat(r)})}).then(A)).then((function(t){U(t,t.owner._id),C(s),e.target.reset()})).catch((function(e){console.log(e)})).finally((function(){x(!1,S)}))})),b.addEventListener("submit",(function(e){var t;e.preventDefault(),x(!0,q),(t=L,fetch("".concat(w.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:w.headers,body:JSON.stringify({avatar:"".concat(t.value)})}).then(A)).then((function(t){a.setAttribute("src","".concat(t.avatar)),C(g),e.target.reset()})).catch((function(e){console.log("Ошибка: ".concat(e.status))})).finally((function(){x(!1,q)}))})),T={inputListSelector:".form__element",submitButtonSelector:".form__submit",formListSelector:".form",inputErrorClass:"form__input_type_error",textErrorClass:"form__input-error_active",disabledButtonClass:"form__submit_disabled"},Array.from(document.querySelectorAll(T.formListSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var r=Array.from(e.querySelectorAll(t.inputListSelector)),o=e.querySelector(t.submitButtonSelector);P(r,o,t),e.addEventListener("reset",(function(){setTimeout((function(){P(r,o,t)}),0)})),r.forEach((function(n){n.addEventListener("input",(function(){!function(e,t,r){t.validity.valid?function(e,t,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(r.inputErrorClass),o.classList.remove(r.textErrorClass),o.textContent=""}(e,t,r):function(e,t,r,o){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),n.textContent=r,n.classList.add(o.textErrorClass)}(e,t,t.validationMessage,r)}(e,n,t),P(r,o,t)}))}))}(e,T)}))})();