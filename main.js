(()=>{"use strict";var e=document.querySelector("#profile-overlay"),t=e.querySelector("#form__name"),r=e.querySelector("#form__nickname"),o=document.querySelector(".profile__name"),n=document.querySelector(".profile__nickname"),c=document.querySelector(".profile__avatar"),a=document.querySelector("#add-overlay"),s=a.querySelector("#add__image-name"),i=a.querySelector("#add__image-url"),l=document.querySelector(".cards"),u=document.querySelector(".profile__edit-button"),d=document.querySelector(".profile__add-button"),f=(e.querySelector(".popup-wrapper__close"),a.querySelector(".popup-wrapper__close"),document.querySelector("#image-popup")),m=document.querySelector(".image-modal__item"),_=document.querySelector(".image-modal__title"),p=(f.querySelector(".popup-wrapper__close"),document.forms.editForm),v=p.querySelector(".form__submit"),h=document.forms.addForm,y=h.querySelector(".form__submit"),S=document.forms.avatarForm,b=S.querySelector(".form__submit"),q=(p.querySelector(".form__element"),h.querySelector(".form__element"),S.querySelector(".form__element")),L=document.querySelector("#avatar-overlay");function g(e){document.querySelectorAll(".popup").forEach((function(t){"Escape"===e.key&&k(t)}))}function E(e){e.classList.add("popup_opened"),e.classList.remove("popup_hidden"),document.addEventListener("keydown",g)}function k(e){e.classList.add("popup_hidden"),e.classList.remove("popup_opened"),document.removeEventListener("keydown",g)}function C(e,t){t.textContent=e?"Сохранить...":"Сохранить"}function x(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}L.querySelector(".popup-wrapper__close");var A={baseUrl:"https://nomoreparties.co/v1/cohort-55",headers:{authorization:"4a077796-6e98-44e5-9c13-60ffdba9f31a","Content-Type":"application/json"}};function w(e,t){var r=function(e,t){var r=e,o=t,n=r.owner._id,c=r.name,a=r.link,s=r._id,i=r.likes,l=i.length,u=document.querySelector(".card-template").content.querySelector(".card").cloneNode(!0),d=u.querySelector(".card__mask"),p=u.querySelector(".card__like"),v=u.querySelector(".card__trash");return d.setAttribute("src",a),d.setAttribute("alt",c),u.querySelector(".card__title").textContent=c,u.querySelector(".card__like-count").textContent=l,i.forEach((function(e){var t=e._id;o===t?p.classList.add("card__like_active"):p.classList.remove("card__like_active")})),p.addEventListener("click",(function(e){!function(e,t,r){var o,n=r.querySelector(".card__like-count");e.target.classList.contains("card__like")&&e.target.classList.contains("card__like_active")?(o=t,fetch("".concat(A.baseUrl,"/cards/likes/").concat(o),{method:"DELETE",headers:A.headers}).then(x)).then((function(t){var r=t.likes;e.target.classList.remove("card__like_active"),n.textContent=r.length})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(A.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:A.headers}).then(x)}(t).then((function(t){var r=t.likes;e.target.classList.add("card__like_active"),n.textContent=r.length})).catch((function(e){console.log(e)}))}(e,s,u)})),o===n?v.addEventListener("click",(function(e){!function(e,t){var r=e.target.closest(".card");console.log(t),e.target.classList.contains("card__trash")&&function(e){return fetch("".concat(A.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:A.headers}).then(x)}(t).then((function(e){console.log(e),r.remove()})).catch((function(e){console.log(e)}))}(e,s)})):v.remove(),d.addEventListener("click",(function(e){var t,r;t=e.target,r=u.querySelector(".card__title"),m.setAttribute("src","".concat(t.getAttribute("src"))),m.setAttribute("alt","".concat(t.getAttribute("alt"))),_.textContent=r.textContent,E(f)})),u}(e,t);l.prepend(r)}function U(e,t,r){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(r.disabledButtonClass),t.removeAttribute("disabled")):(t.classList.add(r.disabledButtonClass),t.setAttribute("disabled",!0))}var T,D=document.querySelectorAll(".popup"),P=fetch("".concat(A.baseUrl,"/users/me"),{headers:A.headers}).then(x),B=fetch("".concat(A.baseUrl,"/cards"),{headers:A.headers}).then(x);Promise.all([P,B]).then((function(e){var t=e[0],r=t.avatar,a=t.name,s=t.about,i=t._id;c.setAttribute("src",r),o.textContent=a,n.textContent=s,e[1].forEach((function(e){w(e,i)}))})).catch((function(e){console.log(e)})),u.addEventListener("click",(function(){E(e),t.value=o.textContent,r.value=n.textContent})),D.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_opened")&&k(e),t.target.classList.contains("popup-wrapper__close")&&k(e)}))})),d.addEventListener("click",(function(){E(a)})),c.addEventListener("click",(function(){E(L)})),p.addEventListener("submit",(function(c){var a,s;c.preventDefault(),C(!0,v),(a=t,s=r,fetch("".concat(A.baseUrl,"/users/me"),{method:"PATCH",headers:A.headers,body:JSON.stringify({name:"".concat(a.value),about:"".concat(s.value)})}).then(x)).then((function(t){o.textContent=t.name,n.textContent=t.about,k(e)})).catch((function(e){console.log("Ошибка: ".concat(e.status))})).finally((function(){C(!1,v)}))})),h.addEventListener("submit",(function(e){var t,r;e.preventDefault(),C(!0,y),(t=s.value,r=i.value,fetch("".concat(A.baseUrl,"/cards"),{method:"POST",headers:A.headers,body:JSON.stringify({name:"".concat(t),link:"".concat(r)})}).then(x)).then((function(t){console.log(t),w(t,t.owner._id),e.target.reset()})).catch((function(e){console.log(e)})).finally((function(){k(a),C(!1,y)}))})),S.addEventListener("submit",(function(e){var t;e.preventDefault(),C(!0,b),(t=q,fetch("".concat(A.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:A.headers,body:JSON.stringify({avatar:"".concat(t.value)})}).then(x)).then((function(t){console.log(t),c.setAttribute("src","".concat(t.avatar)),e.target.reset()})).catch((function(e){console.log("Ошибка: ".concat(e.status))})).finally((function(){k(L),C(!1,b)}))})),T={inputListSelector:".form__element",submitButtonSelector:".form__submit",formListSelector:".form",inputErrorClass:"form__input_type_error",textErrorClass:"form__input-error_active",disabledButtonClass:"form__submit_disabled"},Array.from(document.querySelectorAll(T.formListSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var r=Array.from(e.querySelectorAll(t.inputListSelector)),o=e.querySelector(t.submitButtonSelector);U(r,o,t),e.addEventListener("reset",(function(){setTimeout((function(){U(r,o,t)}),0)})),r.forEach((function(n){n.addEventListener("input",(function(){!function(e,t,r){t.validity.valid?function(e,t,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(r.inputErrorClass),o.classList.remove(r.textErrorClass),o.textContent=""}(e,t,r):function(e,t,r,o){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),n.textContent=r,n.classList.add(o.textErrorClass)}(e,t,t.validationMessage,r)}(e,n,t),U(r,o,t)}))}))}(e,T)}))})();