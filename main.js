(()=>{"use strict";var e=document.querySelector("#profile-overlay"),t=e.querySelector("#form__name"),r=e.querySelector("#form__nickname"),n=document.querySelector(".profile__name"),o=document.querySelector(".profile__nickname"),c=document.querySelector(".profile__avatar"),a=document.querySelector("#add-overlay"),i=a.querySelector("#add__image-name"),s=a.querySelector("#add__image-url"),l=document.querySelector(".cards"),u=document.querySelector(".profile__edit-button"),d=document.querySelector(".profile__add-button"),f=e.querySelector(".popup-wrapper__close"),m=a.querySelector(".popup-wrapper__close"),_=document.querySelector("#image-overlay"),v=_.querySelector(".popup__image"),h=_.querySelector(".popup__title"),y=_.querySelector(".popup-wrapper__close"),p=document.forms.editForm,S=p.querySelector(".form__submit"),b=document.forms.addForm,L=b.querySelector(".form__submit"),g=document.forms.avatarForm,q=g.querySelector(".form__submit"),E=(p.querySelector(".form__element"),b.querySelector(".form__element"),g.querySelector(".form__element")),k=document.querySelector("#avatar-overlay"),C=k.querySelector(".popup-wrapper__close");function A(e){Array.from(document.querySelectorAll(e.formListSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var r=Array.from(e.querySelectorAll(t.inputListSelector)),n=e.querySelector(t.submitButtonSelector);x(r,n,t),r.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,r){t.validity.valid?function(e,t,r){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(r.inputErrorClass),n.classList.remove(r.textErrorClass),n.textContent=""}(e,t,r):function(e,t,r,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n.inputErrorClass),o.textContent=r,o.classList.add(n.textErrorClass)}(e,t,t.validationMessage,r)}(e,o,t),x(r,n,t)}))}))}(t,e)}))}function x(e,t,r){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.classList.remove(r.disabledButtonClass):t.classList.add(r.disabledButtonClass)}function U(e,t){e?(t.removeAttribute("disabled"),t.classList.remove(A.disabledButtonClass)):(t.setAttribute("disabled",!0),t.classList.add(A.disabledButtonClass))}function T(e){document.addEventListener("keydown",F),e.classList.add("overlay"),e.classList.remove("overlay_hidden"),editForm.addEventListener("input",(function(){U(t.value.length>=2&&r.value.length>=2,S)})),addForm.addEventListener("input",(function(){U(i.value.length>=2&&s.value.includes("https://"),L)}))}function w(e){e.classList.add("overlay_hidden"),e.classList.remove("overlay")}function B(e,t){t.textContent=e?"Сохранить...":"Сохранить"}function P(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function D(e,t,r){e.composedPath().includes(r)||w(t)}function F(e){"Escape"===e.key&&w(document.querySelector(".overlay"))}var N={baseUrl:"https://nomoreparties.co/v1/cohort-55",headers:{authorization:"4a077796-6e98-44e5-9c13-60ffdba9f31a","Content-Type":"application/json"}};function O(e,t){var r=function(e,t){var r=e,n=t,o=r.owner._id;console.log(o);var c=r.name,a=r.link,i=r._id,s=r.likes,l=s.length,u=document.querySelector(".card-template").content.querySelector(".card").cloneNode(!0),d=u.querySelector(".card__mask"),f=u.querySelector(".card__like"),m=u.querySelector(".card__trash");return d.setAttribute("src",a),d.setAttribute("alt",c),u.querySelector(".card__title").textContent=c,u.querySelector(".card__like-count").textContent=l,s.forEach((function(e){var t=e._id;n===t?f.classList.add("card__like_active"):f.classList.remove("card__like_active")})),f.addEventListener("click",(function(e){!function(e,t,r){var n,o=r.querySelector(".card__like-count");e.target.classList.contains("card__like")&&e.target.classList.contains("card__like_active")?(e.target.classList.remove("card__like_active"),(n=t,fetch("".concat(N.baseUrl,"/cards/likes/").concat(n),{method:"DELETE",headers:N.headers}).then(P)).then((function(e){console.log(e),o.textContent--})).catch((function(e){console.log(e)}))):(e.target.classList.add("card__like_active"),function(e){return fetch("".concat(N.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:N.headers}).then(P)}(t).then((function(e){console.log(e),o.textContent++})).catch((function(e){console.log(e)})))}(e,i,u)})),n===o?(m.setAttribute("id",i),u.addEventListener("click",(function(e){!function(e,t){console.log(e.target.getAttribute("id")),e.target.classList.contains("card__trash")&&t===e.target.getAttribute("id")&&(function(e){return fetch("".concat(N.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:N.headers}).then(P)}(t).catch((function(e){console.log(e)})),e.currentTarget.remove())}(e,i)}))):m.remove(),d.addEventListener("click",(function(e){var t,r;t=e.target,r=u.querySelector(".card__title"),t.addEventListener("click",(function(){v.setAttribute("src","".concat(t.getAttribute("src"))),v.setAttribute("alt","".concat(t.getAttribute("alt"))),h.textContent=r.textContent,T(_)}))})),u}(e,t);l.prepend(r)}var j=fetch("".concat(N.baseUrl,"/users/me"),{headers:N.headers}).then(P),J=fetch("".concat(N.baseUrl,"/cards"),{headers:N.headers}).then(P);Promise.all([j,J]).then((function(e){var t=e[0],r=t.avatar,a=t.name,i=t.about,s=t._id;c.setAttribute("src",r),n.textContent=a,o.textContent=i,e[1].forEach((function(e){O(e,s)}))})).catch((function(e){console.log(e)})),u.addEventListener("click",(function(){T(e),t.value=n.textContent,r.value=o.textContent,U(!0,S)})),f.addEventListener("click",(function(){w(e)})),d.addEventListener("click",(function(){T(a),U(!1,L)})),m.addEventListener("click",(function(){w(a)})),y.addEventListener("click",(function(){w(_)})),c.addEventListener("click",(function(){T(k),U(!0,q)})),C.addEventListener("click",(function(){w(k)})),e.addEventListener("click",(function(t){D(t,e,p)})),a.addEventListener("click",(function(e){D(e,a,b)})),k.addEventListener("click",(function(e){D(e,k,g)})),_.addEventListener("click",(function(e){D(e,_,v)})),p.addEventListener("submit",(function(c){var a,i;c.preventDefault(),n.textContent=t.value,o.textContent=r.value,B(!0,S),(a=n,i=o,fetch("".concat(N.baseUrl,"/users/me"),{method:"PATCH",headers:N.headers,body:JSON.stringify({name:"".concat(a.textContent),about:"".concat(i.textContent)})}).then(P)).catch((function(e){console.log("Ошибка: ".concat(e.status))})).finally((function(){w(e),B(!1,S)}))})),b.addEventListener("submit",(function(e){var t,r;e.preventDefault(),B(!0,L),(t=i.value,r=s.value,fetch("".concat(N.baseUrl,"/cards"),{method:"POST",headers:N.headers,body:JSON.stringify({name:"".concat(t),link:"".concat(r)})}).then(P)).then((function(e){console.log(e),O(e,e.owner._id)})).catch((function(e){console.log(e)})).finally((function(){w(a),B(!1,L)})),e.target.reset()})),g.addEventListener("submit",(function(e){var t;e.preventDefault(),B(!0,q),c.setAttribute("src","".concat(E.value)),console.log(c.getAttribute("src")),(t=c.getAttribute("src"),fetch("https://nomoreparties.co/v1/cohort-55/users/me/avatar",{method:"PATCH",headers:N.headers,body:JSON.stringify({avatar:"".concat(t)})}).then(P)).catch((function(e){console.log("Ошибка: ".concat(e.status))})).finally((function(){w(k),B(!1,L)})),e.target.reset()})),A({inputListSelector:".form__element",submitButtonSelector:".form__submit",formListSelector:".form",inputErrorClass:"form__input_type_error",textErrorClass:"form__input-error_active",disabledButtonClass:"form__submit_disabled"})})();