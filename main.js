(()=>{"use strict";var e=document.querySelector("#profile-overlay"),t=e.querySelector("#form__name"),n=e.querySelector("#form__nickname"),r=document.querySelector(".profile__name"),o=document.querySelector(".profile__nickname"),c=document.querySelector(".profile__avatar"),a=document.querySelector("#add-overlay"),i=a.querySelector("#add__image-name"),s=a.querySelector("#add__image-url"),l=document.querySelector(".cards"),u=document.querySelector(".profile__edit-button"),d=document.querySelector(".profile__add-button"),f=e.querySelector(".popup-wrapper__close"),m=a.querySelector(".popup-wrapper__close"),_=document.querySelector("#image-overlay"),v=_.querySelector(".popup__image"),h=_.querySelector(".popup__title"),y=_.querySelector(".popup-wrapper__close"),p=document.forms.editForm,S=p.querySelector(".form__submit"),L=document.forms.addForm,b=L.querySelector(".form__submit"),q=document.forms.avatarForm,E=q.querySelector(".form__submit"),g=(p.querySelector(".form__element"),L.querySelector(".form__element"),q.querySelector(".form__element")),k=document.querySelector("#avatar-overlay"),C=k.querySelector(".popup-wrapper__close");function x(e){Array.from(document.querySelectorAll(e.formListSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputListSelector)),r=e.querySelector(t.submitButtonSelector);A(n,r,t),n.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.textErrorClass),r.textContent=""}(e,t,n):function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.textErrorClass)}(e,t,t.validationMessage,n)}(e,o,t),A(n,r,t)}))}))}(t,e)}))}function A(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.classList.remove(n.disabledButtonClass):t.classList.add(n.disabledButtonClass)}function U(e,t){e?(t.removeAttribute("disabled"),t.classList.remove(x.disabledButtonClass)):(t.setAttribute("disabled",!0),t.classList.add(x.disabledButtonClass))}function w(e){document.addEventListener("keydown",F),e.classList.add("overlay"),e.classList.remove("overlay_hidden"),editForm.addEventListener("input",(function(){U(t.value.length>=2&&n.value.length>=2,S)})),addForm.addEventListener("input",(function(){U(i.value.length>=2&&s.value.includes("https://"),b)}))}function B(e){e.classList.add("overlay_hidden"),e.classList.remove("overlay")}function P(e,t){t.textContent=e?"Сохранить...":"Сохранить"}function T(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function D(e,t,n){e.composedPath().includes(n)||B(t)}function F(e){"Escape"===e.key&&B(document.querySelector(".overlay"))}var N={baseUrl:"https://nomoreparties.co/v1/cohort-55",headers:{authorization:"4a077796-6e98-44e5-9c13-60ffdba9f31a","Content-Type":"application/json"}};function O(e,t){var n=function(e,t){var n=e,r=t,o=n.owner._id,c=n.name,a=n.link,i=n._id,s=n.likes,l=s.length,u=document.querySelector(".card-template").content.querySelector(".card").cloneNode(!0),d=u.querySelector(".card__mask"),f=u.querySelector(".card__like"),m=u.querySelector(".card__trash");return d.setAttribute("src",a),d.setAttribute("alt",c),u.querySelector(".card__title").textContent=c,u.querySelector(".card__like-count").textContent=l,s.forEach((function(e){var t=e._id;r===t?f.classList.add("card__like_active"):f.classList.remove("card__like_active")})),f.addEventListener("click",(function(e){!function(e,t,n){var r,o=n.querySelector(".card__like-count");e.target.classList.contains("card__like")&&e.target.classList.contains("card__like_active")?(r=t,fetch("".concat(N.baseUrl,"/cards/likes/").concat(r),{method:"DELETE",headers:N.headers}).then(T)).then((function(t){console.log(t),e.target.classList.remove("card__like_active"),o.textContent--})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(N.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:N.headers}).then(T)}(t).then((function(t){console.log(t),e.target.classList.add("card__like_active"),o.textContent++})).catch((function(e){console.log(e)}))}(e,i,u)})),r===o?m.addEventListener("click",(function(e){!function(e,t){var n=e.target.closest(".card");console.log(t),e.target.classList.contains("card__trash")&&function(e){return fetch("".concat(N.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:N.headers}).then(T)}(t).then((function(e){console.log(e),n.remove()})).catch((function(e){console.log(e)}))}(e,i)})):m.remove(),d.addEventListener("click",(function(e){var t,n;t=e.target,n=u.querySelector(".card__title"),t.addEventListener("click",(function(){v.setAttribute("src","".concat(t.getAttribute("src"))),v.setAttribute("alt","".concat(t.getAttribute("alt"))),h.textContent=n.textContent,w(_)}))})),u}(e,t);l.prepend(n)}var j=fetch("".concat(N.baseUrl,"/users/me"),{headers:N.headers}).then(T),J=fetch("".concat(N.baseUrl,"/cards"),{headers:N.headers}).then(T);Promise.all([j,J]).then((function(e){var t=e[0],n=t.avatar,a=t.name,i=t.about,s=t._id;c.setAttribute("src",n),r.textContent=a,o.textContent=i,e[1].forEach((function(e){O(e,s)}))})).catch((function(e){console.log(e)})),u.addEventListener("click",(function(){w(e),t.value=r.textContent,n.value=o.textContent,U(!0,S)})),f.addEventListener("click",(function(){B(e)})),d.addEventListener("click",(function(){w(a),U(!1,b)})),m.addEventListener("click",(function(){B(a)})),y.addEventListener("click",(function(){B(_)})),c.addEventListener("click",(function(){w(k),U(!0,E)})),C.addEventListener("click",(function(){B(k)})),e.addEventListener("click",(function(t){D(t,e,p)})),a.addEventListener("click",(function(e){D(e,a,L)})),k.addEventListener("click",(function(e){D(e,k,q)})),_.addEventListener("click",(function(e){D(e,_,v)})),p.addEventListener("submit",(function(c){var a,i;c.preventDefault(),r.textContent=t.value,o.textContent=n.value,P(!0,S),(a=r,i=o,fetch("".concat(N.baseUrl,"/users/me"),{method:"PATCH",headers:N.headers,body:JSON.stringify({name:"".concat(a.textContent),about:"".concat(i.textContent)})}).then(T)).catch((function(e){console.log("Ошибка: ".concat(e.status))})).finally((function(){B(e),P(!1,S)}))})),L.addEventListener("submit",(function(e){var t,n;e.preventDefault(),P(!0,b),(t=i.value,n=s.value,fetch("".concat(N.baseUrl,"/cards"),{method:"POST",headers:N.headers,body:JSON.stringify({name:"".concat(t),link:"".concat(n)})}).then(T)).then((function(e){console.log(e),O(e,e.owner._id)})).catch((function(e){console.log(e)})).finally((function(){B(a),P(!1,b)})),e.target.reset()})),q.addEventListener("submit",(function(e){var t;e.preventDefault(),P(!0,E),c.setAttribute("src","".concat(g.value)),console.log(c.getAttribute("src")),(t=c.getAttribute("src"),fetch("https://nomoreparties.co/v1/cohort-55/users/me/avatar",{method:"PATCH",headers:N.headers,body:JSON.stringify({avatar:"".concat(t)})}).then(T)).catch((function(e){console.log("Ошибка: ".concat(e.status))})).finally((function(){B(k),P(!1,b)})),e.target.reset()})),x({inputListSelector:".form__element",submitButtonSelector:".form__submit",formListSelector:".form",inputErrorClass:"form__input_type_error",textErrorClass:"form__input-error_active",disabledButtonClass:"form__submit_disabled"})})();